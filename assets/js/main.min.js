let selectedDesign=null,selectedImageSrc=null,designSwiper,textSwiper,certificateValue=0,nominalValue=0;const inputs={design:document.getElementById("designInput"),text:document.getElementById("textCardInput"),price:document.getElementById("priceInput"),senderName:document.getElementById("senderName"),senderEmail:document.getElementById("senderEmail"),senderCity:document.getElementById("senderCity"),senderReceivingType:document.querySelector('input[name="senderReceivingType"]:checked'),recipientName:document.getElementById("recipientName"),recipientPhone:document.getElementById("recipientPhone"),recipientCity:document.getElementById("recipientCity")},initDesignSwiper=()=>{console.log("инитсвипер"),designSwiper&&(designSwiper.destroy(!0,!0),console.log("дестрой")),(designSwiper=new Swiper(".design__swiper",{direction:"horizontal",slidesPerView:1,spaceBetween:7,initialSlide:1,pagination:{el:".design__swiper-paginaton"},navigation:{nextEl:".design__swiper-button-next",prevEl:".design__swiper-button-prev"},on:{slideChangeTransitionEnd:selectDesign}})).slideTo(sessionStorage.getItem("activeSlideIndex")-1||0,0),console.log("сохранённый индекс:",sessionStorage.getItem("activeSlideIndex")),selectDesign()},selectDesign=()=>{let e=document.querySelector(".design__swiper-slide.swiper-slide-active"),t=e.getAttribute("data-design"),i=document.getElementById("designInput");i.value=t;let n=e.querySelector(".design__slide-img");selectedImageSrc=n.src,console.log("Сохраненный дизайн:",i.value,"Сохраненная картинка:",selectedImageSrc),sessionStorage.setItem("activeSlideIndex",t),console.log("сохранённый индекс:",sessionStorage.getItem("activeSlideIndex"))},initTextSwiper=()=>{console.log("инит textSwiper"),textSwiper&&(textSwiper.destroy(!0,!0),console.log("textSwiper уничтожен")),(textSwiper=new Swiper(".text-page__swiper",{direction:"horizontal",slidesPerView:1,spaceBetween:20,pagination:{el:".text-page__swiper-pagination"},navigation:{nextEl:".text-page__swiper-button-next",prevEl:".text-page__swiper-button-prev"},on:{slideChangeTransitionEnd:selectText}})).slideTo(sessionStorage.getItem("activeTextSlideIndex")||1,0),console.log("сохранённый индекс текста:",sessionStorage.getItem("activeTextSlideIndex")),selectText()},selectText=()=>{let e=document.querySelector(".text-page__swiper-slide.swiper-slide-active"),t=e.querySelector(".text-page__slide-text").textContent.trim(),i=document.getElementById("textCardInput");i.value=t;let n=document.querySelector(".text-page__card-title");n.textContent=t,console.log("Сохраненный текст:",t),sessionStorage.setItem("activeTextSlideIndex",textSwiper.realIndex),console.log("сохранённый индекс текста:",sessionStorage.getItem("activeTextSlideIndex"))};document.addEventListener("DOMContentLoaded",function(){let e=document.querySelector(".main-page"),t=document.querySelector(".inner-page"),i=document.querySelector(".loading-page"),n=document.querySelector(".final-page"),a=document.querySelector(".main-page__button"),r=t.querySelector(".next-button"),l=t.querySelector(".back-button"),c=t.querySelectorAll(".inner-page__content > div"),s=document.querySelector(".inner-page__title"),d={"design-page":"Выбери оформление","text-page":"Выбери текст","amount-page":"Выбери номинал","data-page-one":"Введите данные","data-page-two":"Введите данные"},o={main:"linear-gradient(155deg, #181818 17%, #9B68BF)",final:"linear-gradient(180deg, #181818 18%, #9B68BF)",default:"#181818"};function g(e){let t=document.querySelector(".wrapper");t&&(t.style.background=o[e]||o.default)}let p=sessionStorage.getItem("currentStep")||0;function u(e){if(c.forEach(e=>e.style.display="none"),e.style.display="flex",s.textContent=d[e.classList[0]],e.classList.contains("main-page")?g("main"):e.classList.contains("final-page")?g("final"):g("default"),e.classList.contains("text-page")){console.log(sessionStorage.getItem("activeSlideIndex"));let t=e.querySelector(".text-page__card-img");selectedImageSrc&&(t.src=selectedImageSrc),initTextSwiper()}e.classList.contains("amount-page")&&function e(){let t=document.querySelectorAll(".amount-page__price-button"),i=document.getElementById("priceInput"),n;if(sessionStorage.getItem("priceValue")){let a=sessionStorage.getItem("priceValue");m(a);let r=document.querySelectorAll(".amount-page__price-button");r.forEach(e=>{e.getAttribute("data-price")===a?e.classList.add("active"):e.classList.remove("active")})}else m(t[0].getAttribute("data-price")),t[0].classList.add("active");t.forEach(e=>{e.addEventListener("click",function(){t.forEach(e=>e.classList.remove("active")),e.classList.add("active"),n=e.getAttribute("data-price"),console.log(i.value),m(n)})})}(),e.classList.contains("data-page-one")&&function e(){let t=document.querySelector(".data-page-one__form");function i(){y.senderName=t.querySelector("#senderName").value,y.senderEmail=t.querySelector("#senderEmail").value,y.senderCity=t.querySelector("#senderCity").value,y.senderReceivingType=t.querySelector('input[name="senderReceivingType"]:checked')?.id||"",sessionStorage.setItem("senderFormData",JSON.stringify(y))}t.addEventListener("input",function(e){("senderName"===e.target.id||"senderEmail"===e.target.id)&&i()}),t.addEventListener("change",function(e){("senderCity"===e.target.id||"senderReceivingType"===e.target.name)&&i()}),function e(){let i=sessionStorage.getItem("senderFormData");i&&(y=JSON.parse(i),t.querySelector("#senderName").value=y.senderName,t.querySelector("#senderEmail").value=y.senderEmail,t.querySelector("#senderCity").value=y.senderCity,y.senderReceivingType&&(t.querySelector(`#${y.senderReceivingType}`).checked=!0))}()}(),e.classList.contains("data-page-two")&&(function e(){let t=document.querySelector(".data-page-two__form");function i(){S.recipientName=t.querySelector("#recipientName").value,S.recipientPhone=t.querySelector("#recipientPhone").value,S.recipientCity=t.querySelector("#recipientCity").value,sessionStorage.setItem("recipientFormData",JSON.stringify(S))}t.addEventListener("input",function(e){("recipientName"===e.target.id||"recipientPhone"===e.target.id)&&i()}),t.addEventListener("change",function(e){"recipientCity"===e.target.id&&i()}),function e(){let i=sessionStorage.getItem("recipientFormData");i&&(S=JSON.parse(i),t.querySelector("#recipientName").value=S.recipientName,t.querySelector("#recipientPhone").value=S.recipientPhone,t.querySelector("#recipientCity").value=S.recipientCity)}()}(),console.log(S),inputs.senderReceivingType=document.querySelector('input[name="senderReceivingType"]:checked'))}function m(e){console.log(2,e),priceInput.value=+e,sessionStorage.setItem("priceValue",priceInput.value),certificateValue=+e,nominalValue=+e+2e3,document.getElementById("certificate-value").textContent=`${certificateValue}₽`,document.getElementById("bonuses-value").textContent=`+2000₽`,document.getElementById("your-certificate-value").textContent=`${nominalValue}₽`,document.getElementById("total-value").textContent=`${certificateValue}₽`,sessionStorage.setItem("certificateValue",certificateValue),sessionStorage.setItem("nominalValue",nominalValue)}console.log(p),a.addEventListener("click",function(){e.style.display="none",t.style.display="block",u(c[0]),initDesignSwiper(),p=0,sessionStorage.setItem("currentStep",p)}),r.addEventListener("click",function(){p<c.length-1?(u(c[++p]),sessionStorage.setItem("currentStep",p),console.log(p)):(t.style.display="none",i.style.display="block",fillFinalForm(),setTimeout(()=>{i.style.display="none",n.style.display="block",g("final")},2e3))}),l.addEventListener("click",function(){if(p>0){if(u(c[--p]),console.log(p),0===p)designSwiper.slideTo(sessionStorage.getItem("activeSlideIndex")-1||0,0),console.log("переход к слайду(назад):",sessionStorage.getItem("activeSlideIndex"));else if(2===p){let i=sessionStorage.getItem("priceValue");console.log(1,i),m(i);let n=document.querySelectorAll(".amount-page__price-button");n.forEach(e=>{e.getAttribute("data-price")===i?e.classList.add("active"):e.classList.remove("active")})}}else t.style.display="none",e.style.display="flex",sessionStorage.clear(),g("main")});let y={senderName:"",senderEmail:"",senderCity:"",senderReceivingType:""},S={recipientName:"",recipientPhone:"",recipientCity:""}});const fillFinalForm=()=>{let e=document.getElementById("finalForm");if(!e){console.error("Финальная форма не найдена");return}let t=e=>e.charAt(0).toUpperCase()+e.slice(1);for(let i in inputs){let n=e.querySelector(`[name="final${t(i)}"]`);"senderReceivingType"===i?n.value=inputs[i]?.id||"":n&&(n.value=inputs[i].value)}let a=document.querySelector(".final-page__card");if(a){let r=a.querySelector(".final-page__card-img"),l=a.querySelector(".final-page__card-title");r&&(r.src=selectedImageSrc||"./assets/images/design-page/slide-img-2.png"),l&&(l.textContent=inputs.text.value||"")}let c=document.querySelector(".final-page__button");if(c){let s=sessionStorage.getItem("certificateValue")||0,d=sessionStorage.getItem("nominalValue")||0,o=`#order:Сертификат ${s}=${d}`;c.setAttribute("href",o),console.log(c)}console.log("Значения успешно подставлены в финальную форму")};window.addEventListener("beforeunload",function(){sessionStorage.clear()});